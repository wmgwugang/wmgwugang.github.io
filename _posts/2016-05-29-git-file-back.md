---
layout: post
title:  一次使用Git文件丢失的经历
date:   2016-05-29
categories: Git
tags: [git]
---

最近，公司开始使用Git来管理代码。换了一种工具，少不了要在坑里走几回，这不，由于对命令不熟悉，一不小心把写好的代码给弄丢了，最后，历尽千辛万苦，终于找回来了。找回的过程，在这里做一简单的记录。


#### 还原场景

事情的经过时这样的，我在自己本地建了一个分支，主要用来自己开发，觉得没问题了，在往主开发分支上合并。这天，我和往常一样，不停的Coding，好不容易，功能马上就要写好了，我也正准备合并到开发分支上去。这时候有一个比较急的BUG需要修改，我需要先切换到主开发分支上去，我就用了**$ git stash ** 命令，将我当前的代码暂存了起来，然后切换到主分支，获取最新代码，修改BUG，提交，一切完美的解决。完了之后我又切换到我自己的开发分支上，继续我之前未完成的工作，我用 ** $  git stash apply stash@{0} **将之前储藏的工作重新应用。本来，到这里，一切都没有啥问题，但是，不知为何脑残，我用了个删除命令 ** $ git stash drop stash@{0}** 命令删除了本次的储藏(最主要的是删除的时候还没有觉察到有何不妥)，然后我准备继续我的未完成的工作，这时候，VS 弹出了一个对话框，大意是工作环境有变化，然后我就点了个全部重新加载，完了之后我发现我前面所有的代码，以及新加的文件都找不到了。这时候我意识到发生了什么，是刚才的删除命令造成的，更悲剧的是我之前写的代码没有做任何 add 操作，我觉得代码找不回来了，一上午的工作都白干了。


#### 查找挽救办法

发现代码丢了之后，我不敢再做任何其他操作，因为我对找回代码还抱了一点点希望。我就在网上查，看看有没有挽救的办法；去我加的技术群里问大神，希望他们能告诉我一些秘笈。一个多小时后，一位大神给我发了一个** $ git fsck ** 命令，让我试试。我像抓住了救命稻草一样，又去查** $ git fsck ** 命令的用法，试着操作，最终，终于找回来了。

#### 解决办法

** $ git fsck ** 是用来检查内部数据库或问题的不一致性。

1. 通过 ** $ git fsck --full **命令可以列出所有没有被其他对象指向的对象。
2. 然后通过 ** $ git show ** 查看每一个对象的大致内容，通过一个个的查看后，终于找到了代码丢失前最新的部分。
3. 使用 ** $ git reset head ** 命令指向需要恢复的记录。这样，丢失的代码就找回来了。


我只是简要的记录了下找回丢失代码的过程，可能这之间有很多操作，包括使用Git的方式都有不对的地方，对Git的有些命令也使用的不当。慢慢的熟悉了Git之后，就应该不会犯这些错误了。
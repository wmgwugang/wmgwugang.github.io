---
layout: post
title:  "最近工作问题总结"
date:   2017-02-24
categories: 生活随笔
---

最近，工作上遇到了一些未能解决的问题，特此记录。

### 一、 由于单例模式引发的错误：

由于项目需要调用第三方短信接口发送短信，于是同事就简单的将第三方的接口进行封装，并用到了单例模式，开发过程中和测试过程都没有发现问题，于是就发布了。但发布之后，问题就出现了，客户频繁反映无法收到短信，但自己测试又无法重现，于是怀疑问题出在短信平台上。但短信平台一口咬定不是他们的问题，没办法，只能先还是从自身代码排查。后来就想是不是由于在调用短信接口的时候采用的是单例模式造成的。于是，就将单例模式改成了普通的实例化对象调用，发布后一切正常，在也没有客户反应收不到短信了。

但是，一直不解的是为什么采用单例模式在开发的时候是正常发送的，发布后就出现问题，到现在都没明白。

### 二、由于数据库连接未释放引发的错误：

由于项目需要和第三方平台进行数据交互，于是我们采用了WCF应用程序发布的WebService服务接收对方传递过来的数据，但在接收数据的过程中，经常发现我们的服务链接不上，造成数据丢失。一开始以为是由于对方调用平凡或每次传输数据过多造成的，于是就跟对方商量降低调用频率和每次传递的数据量，直到最后2分钟一次，一次发5条，仍然没能解决，我们开始怀疑是自己方面的问题了。然后，我们从修改IIS设置，但最后还是没能解决问题，丢失数据的情况还是经常发生。项目临近验收，但接口的问题处理不好，始终是个隐患。期间，我也有怀疑过是不是由于数据库连接未主动关闭造成的,但又否定了。我们用的是Entity FrameWork、WCF，项目本身也没有主动关闭数据库连接，但都没有任何问题，而且，领导也一直强调，Entity FrameWork 没有这么差。

后来，在一次本地测试的时候，我通过循环调用发布的webservice接口来模拟对方的定时调用，这时候发现，循环到50次左右的时候，就会抛出数据库连接超时的错误，然后我就想到会不会是由于数据库连接未释放造成的。于是果断改代码，再发布测试，没想到正常了，我看到了接口正常的曙光。毫不犹豫的将正式环境中的几个常用的接口的代码进行修改，每次方法执行完毕就将数据库连接释放。发布后，运行了一天一夜，没有发现异常，IIS日志也不在有500错误，接口问题解决了，于是将所有的接口全部处理。

问题解决了，但没有明白是为什么，同样都没有主动关闭连接，除了发布的接口，其他地方都没有任何问题。

### 三、项目验收

接口问题解决了，项目也终于可以验收了，很开心，但是繁琐的流程让我欲哭无泪。一开始说好的不开验收会，相关部门领导直接签字，结果领导不在；等领导回来了，验收会还是要开，不开太随意了；好不容易开完了，会议纪要签字又找不到人，不是开会就是外出，一拖再拖，心力交瘁。